---
title: Key Monitoring Metrics of TiKV
summary: Learn some key metrics displayed on the Grafana TiKV dashboard.
---

# TiKVの主要な監視メトリクス {#key-monitoring-metrics-of-tikv}

TiUPを使用してTiDBクラスタを展開すると、監視システム（Prometheus/Grafana）が同時に展開されます。詳細については、[監視フレームワークの概要](/tidb-monitoring-framework.md)を参照してください。

Grafanaダッシュボードは、概要、PD、TiDB、TiKV、Node\_exporter、Performance\_overviewなどの一連のサブダッシュボードに分かれており、診断に役立つ多くのメトリクスがあります。

## TiKV-Detailsダッシュボード {#tikv-details-dashboard}

**TiKV-Details**ダッシュボードでは、コンポーネントTiKVの状態の概要と主要なメトリクスが表示されます。[パフォーマンスマップ](https://asktug.com/_/tidb-performance-map/#/)によれば、クラスタの状態が期待どおりかどうかを確認できます。

このセクションでは、**TiKV-Details**ダッシュボードのこれらの主要なメトリクスについて詳細に説明します。

### クラスタ {#cluster}

- ストアサイズ：TiKVインスタンスごとのストレージサイズ
- 利用可能サイズ：TiKVインスタンスごとの利用可能容量
- 容量サイズ：TiKVインスタンスごとの容量サイズ
- CPU：TiKVインスタンスごとのCPU利用率
- メモリ：TiKVインスタンスごとのメモリ使用量
- IO利用率：TiKVインスタンスごとのI/O利用率
- MBps：各TiKVインスタンスでの読み取りと書き込みの合計バイト数
- QPS：各TiKVインスタンスでのコマンドごとのQPS
- Errps：gRPCメッセージの失敗率
- leader：TiKVインスタンスごとのリーダー数
- Region：TiKVインスタンスごとのリージョン数
- Uptime：最後の再起動以降のTiKVの実行時間

![TiKVダッシュボード - クラスタメトリクス](/media/tikv-dashboard-cluster.png)

### エラー {#errors}

- クリティカルエラー：クリティカルエラーの数
- サーバーがビジー：TiKVインスタンスが一時的に利用できなくなるイベントの発生を示します。通常はWrite StallやChannel Fullなどです。通常は`0`であるべきです。
- サーバーレポートの失敗：サーバーによって報告されたエラーメッセージの数。通常は`0`であるべきです。
- Raftstoreエラー：各TiKVインスタンスごとのRaftstoreエラーの数
- スケジューラエラー：各TiKVインスタンスごとのスケジューラエラーの数
- Coprocessorエラー：各TiKVインスタンスごとのCoprocessorエラーの数
- gRPCメッセージエラー：各TiKVインスタンスごとのgRPCメッセージエラーの数
- リーダードロップ：TiKVインスタンスごとのドロップされたリーダーの数
- リーダーミッシング：TiKVインスタンスごとの見逃されたリーダーの数
- ログレプリケーションリジェクト：各TiKVインスタンスでメモリが不足しているために拒否されたログ追加メッセージの数

![TiKVダッシュボード - エラーメトリクス](/media/tikv-dashboard-errors-v610.png)

### サーバー {#server}

- CFサイズ：各カラムファミリーのサイズ
- ストアサイズ：TiKVインスタンスごとのストレージサイズ
- チャネルフル：各TiKVインスタンスごとのチャネルフルエラーの数。通常は`0`であるべきです。
- アクティブな書き込みリーダー：各TiKVインスタンスで書き込まれているリーダーの数
- 近似リージョンサイズ：近似リージョンサイズ
- 近似リージョンサイズヒストグラム：各近似リージョンサイズのヒストグラム
- リージョン平均書き込みキー：各TiKVインスタンスでのリージョンへの書き込みキーの平均数
- リージョン平均書き込みバイト：各TiKVインスタンスでのリージョンへの書き込みバイトの平均数

![TiKVダッシュボード - サーバーメトリクス](/media/tikv-dashboard-server.png)

### gRPC {#grpc}

- gRPCメッセージ数：タイプごとのgRPCメッセージのレート
- gRPCメッセージ失敗：失敗したgRPCメッセージのレート
- 99% gRPCメッセージデュレーション：メッセージタイプごとのgRPCメッセージのデュレーション（P99）
- 平均gRPCメッセージデュレーション：gRPCメッセージの平均実行時間
- gRPCバッチサイズ：TiDBとTiKV間のgRPCメッセージのバッチサイズ
- Raftメッセージバッチサイズ：TiKVインスタンス間のRaftメッセージのバッチサイズ
- gRPCリクエストソースQPS：gRPCリクエストソースのQPS
- gRPCリクエストソースデュレーション：gRPCリクエストソースの実行時間

### スレッドCPU {#thread-cpu}

- RaftストアCPU：`raftstore`スレッドのCPU利用率。通常の場合、CPU利用率は80% \* `raftstore.store-pool-size`未満であるべきです。
- Async apply CPU：`async apply`スレッドのCPU利用率。通常の場合、CPU利用率は90% \* `raftstore.apply-pool-size`未満であるべきです。
- ストアライターCPU：非同期IOスレッドのCPU利用率。通常の場合、CPU利用率は90% \* `raftstore.store-io-pool-size`未満であるべきです。
- gRPCポーリングCPU：`gRPC`スレッドのCPU利用率。通常の場合、CPU利用率は80% \* `server.grpc-concurrency`未満であるべきです。
- スケジューラワーカーCPU：`スケジューラワーカー`スレッドのCPU利用率。通常の場合、CPU利用率は90% \* `storage.scheduler-worker-pool-size`未満であるべきです。
- ストレージReadPool CPU：`ストレージリードプール`スレッドのCPU利用率
- 統一リードプールCPU：`統一リードプール`スレッドのCPU利用率
- RocksDB CPU：RocksDBスレッドのCPU利用率
- Coprocessor CPU：`coprocessor`スレッドのCPU利用率
- GCワーカーCPU：`GCワーカー`スレッドのCPU利用率
- バックグラウンドワーカーCPU：`バックグラウンドワーカー`スレッドのCPU利用率
- インポートCPU：`インポート`スレッドのCPU利用率
- バックアップワーカーCPU：`バックアップ`スレッドのCPU利用率
- CDCワーカーCPU：`CDCワーカー`スレッドのCPU利用率
- CDCエンドポイントCPU：`CDCエンドポイント`スレッドのCPU利用率
- RaftlogフェッチワーカーCPU：非同期RaftログフェッチャーワーカーのCPU利用率
- TSOワーカーCPU：`TSOワーカー`スレッドのCPU利用率

### PD {#pd}

- PDリクエスト：TiKVがPDに送信するレート
- PDリクエストデュレーション（平均）：TiKVがPDに送信するリクエストの平均処理時間
- PDハートビート：TiKVからPDへ送信されるハートビートメッセージのレート
- PD検証ピア：TiKVからPDへTiKVピアを検証するメッセージのレート

### Raft IO {#raft-io}

- ログ適用デュレーション：Raftがログを適用するためにかかる時間
- サーバーごとのログ適用デュレーション：TiKVインスタンスごとのログ適用デュレーション
- ログ追加デュレーション：Raftがログを追加するためにかかる時間
- サーバーごとのログ追加デュレーション：TiKVインスタンスごとのログ追加デュレーション
- ログコミットデュレーション：Raftがログをコミットするためにかかる時間
- サーバーごとのログコミットデュレーション：TiKVインスタンスごとのログコミットデュレーション

![TiKVダッシュボード - Raft IOメトリクス](/media/tikv-dashboard-raftio.png)

### Raftプロセス {#raft-process}

- レディハンドル：タイプごとの処理されたレディオペレーションの数（秒あたり）
  - count：秒あたりの処理されたレディオペレーションの数
  - has\_ready\_region：秒あたりのレディなリージョンの数
  - pending\_region：レディかどうかをチェックするリージョンの操作。v3.0.0以降は非推奨です
  - message：秒あたりのレディオペレーションに含まれるメッセージの数
  - append：秒あたりのレディオペレーションに含まれるRaftログエントリの数
  - commit：秒あたりのレディオペレーションに含まれるコミットされたRaftログエントリの数
  - snapshot：秒あたりのレディオペレーションに含まれるスナップショットの数
- Raftストアイベントの0.99デュレーション：Raftストアイベントにかかる時間（P99）
- プロセスレディデュレーション：Raftのプロセスがレディになるためにかかる時間
- サーバーごとのプロセスレディデュレーション：TiKVインスタンスごとのRaftのピアプロセスがレディになるためにかかる時間。2秒未満であるべきです（P99.99）。
- Raftストアイベントの最大デュレーション：最も遅いRaftストアイベントにかかる時間
- レプリカリードロックチェックデュレーション：レプリカリードの処理中にロックをチェックするためにかかる時間
- ピアメッセージ長分布：各TiKVインスタンスの各リージョンで処理されるメッセージの数。メッセージが多いほど、ピアが忙しいです。

![TiKVダッシュボード - Raftプロセスメトリクス](/media/tikv-dashboard-raft-process.png)

### Raftメッセージ {#raft-message}

- サーバーごとの送信メッセージ：各TiKVインスタンスが送信するRaftメッセージの数（秒あたり）
- サーバーごとのフラッシュメッセージ：各TiKVインスタンスのRaftクライアントによってフラッシュされるRaftメッセージの数（秒あたり）
- サーバーごとの受信メッセージ：各TiKVインスタンスが受信するRaftメッセージの数（秒あたり）
- メッセージ：タイプごとの秒あたりのRaftメッセージの数
- 投票：Raftで送信される投票メッセージの数（秒あたり）
- Raftドロップメッセージ：タイプごとの秒あたりのドロップされたRaftメッセージの数

![TiKVダッシュボード - Raftメッセージメトリクス](/media/tikv-dashboard-raft-message.png)

### Raft提案 {#raft-propose}

- 準備ごとにRaft提案を適用します：バッチごとに含まれる各準備操作の提案数のヒストグラムを適用する際の提案数。
- Raft読み書き提案：タイプごとの提案数/秒
- サーバーごとのRaft読み提案：各TiKVインスタンスが行う読み提案の数/秒
- サーバーごとのRaft書き提案：各TiKVインスタンスが行う書き提案の数/秒
- 提案待ち時間：各提案の待ち時間のヒストグラム
- サーバーごとの提案待ち時間：各TiKVインスタンスごとの各提案の待ち時間のヒストグラム
- 適用待ち時間：各提案の適用時間のヒストグラム
- サーバーごとの適用待ち時間：各TiKVインスタンスごとの各提案の適用時間のヒストグラム
- Raftログ速度：ピアがログを提案する平均速度

![TiKVダッシュボード - Raft提案メトリクス](/media/tikv-dashboard-raft-propose.png)

### Raft管理 {#raft-admin}

- 管理提案：秒ごとの管理提案の数
- 管理適用：秒ごとの処理された適用コマンドの数
- 分割チェック：秒ごとのRaftstore分割チェックコマンドの数
- 99.99%分割チェック時間：分割チェックコマンドを実行する際に消費される時間（P99.99）

![TiKVダッシュボード - Raft管理メトリクス](/media/tikv-dashboard-raft-admin.png)

### ローカルリーダー {#local-reader}

- ローカルリーダーリクエスト：ローカル読み取りスレッドからの合計リクエスト数と拒否数

![TiKVダッシュボード - ローカルリーダーメトリクス](/media/tikv-dashboard-local-reader.png)

### 統一リードプール {#unified-read-pool}

- レベルごとの使用時間：統一リードプールで各レベルに消費される時間。レベル0は小規模なクエリを意味します。
- レベル0の割合：統一リードプールでのレベル0タスクの割合
- 実行中のタスク：統一リードプールで同時に実行されているタスクの数

### ストレージ {#storage}

- ストレージコマンド合計：タイプごとの受信コマンド数/秒
- ストレージ非同期リクエストエラー：エンジン非同期リクエストエラー数/秒
- ストレージ非同期スナップショット時間：非同期スナップショットリクエストの処理にかかる時間。`.99`で`1s`未満であるべきです。
- ストレージ非同期書き込み時間：非同期書き込みリクエストの処理にかかる時間。`.99`で`1s`未満であるべきです。

![TiKVダッシュボード - ストレージメトリクス](/media/tikv-dashboard-storage.png)

### フローコントロール {#flow-control}

- スケジューラフロー：リアルタイムで各TiKVインスタンス上のスケジューラトラフィック
- スケジューラ破棄率：各TiKVインスタンス上のスケジューラリクエストの拒否率。この比率が0より大きい場合、フローコントロールが存在することを示します。`Compaction pending bytes`がその閾値を超えると、TiKVは`Scheduler discard ratio`を超えた部分に基づいて線形に増加させます。クライアントは拒否されたリクエストを自動的に再試行します。
- スロットル待機時間：フローコントロールがトリガーされたときのスケジューラリクエストの実行のためのブロックされた時間。このメトリクスに値がある場合、フローコントロールが存在することを示します。
- スケジューラスロットルCF：フローコントロールの閾値に達したときにRocksDBスロットルをトリガーするCF。
- フローコントロールアクション：フローコントロールの閾値に達したときにRocksDBスロットルをトリガーするアクション。
- Flush/L0フロー：各TiKVインスタンスのRocksDBの異なるCFのフラッシュおよびL0コンパクショントラフィック。
- フローコントロール要因：RocksDBスロットルをトリガーする関連要因。
- Compaction pending bytes：各TiKVインスタンスでリアルタイムにコンパクションを待っているRocksDBデータのサイズ。
- Txnコマンドスロットル待機時間：スロットリングによるトランザクションに関連するコマンドのブロックされた時間。通常の状況では、このメトリクスは0です。
- 非Txnコマンドスロットル待機時間：スロットリングによる他のコマンドのブロックされた時間。通常の状況では、このメトリクスは0です。

![TiKVダッシュボード - フローコントロールメトリクス](/media/tikv-dashboard-flow-control.png)

### スケジューラ {#scheduler}

- スケジューラステージ合計：秒ごとの各ステージのコマンド数。短時間で多くのエラーがあってはなりません。
- スケジューラ書き込みバイト：各TiKVインスタンスで処理されたコマンドによって書き込まれた合計バイト数
- スケジューラ優先コマンド：秒ごとの異なる優先コマンドの数
- スケジューラ保留コマンド：秒ごとのTiKVインスタンスごとの保留コマンドの数

![TiKVダッシュボード - スケジューラメトリクス](/media/tikv-dashboard-scheduler.png)

### スケジューラ - コミット {#scheduler-commit}

- スケジューラステージ合計：コミットコマンドの実行時の各ステージのコマンド数/秒。短時間で多くのエラーがあってはなりません。
- スケジューラコマンド時間：コミットコマンドの実行時に消費される時間。`1s`未満であるべきです。
- スケジューララッチ待機時間：コミットコマンドの実行時にラッチによって引き起こされる待機時間。`1s`未満であるべきです。
- スケジューラ読み取りキー：コミットコマンドによって読み取られたキーの数
- スケジューラ書き込みキー：コミットコマンドによって書き込まれたキーの数
- スケジューラスキャンの詳細：コミットコマンドの実行時の各CFのキースキャンの詳細。
- スケジューラスキャンの詳細\[ロック]：`commit`コマンドの実行時のロックCFのキースキャンの詳細
- スケジューラスキャンの詳細\[書き込み]：`commit`コマンドの実行時の書き込みCFのキースキャンの詳細
- スケジューラスキャンの詳細\[デフォルト]：`commit`コマンドの実行時のデフォルトCFのキースキャンの詳細

![TiKVダッシュボード - スケジューラコミットメトリクス](/media/tikv-dashboard-scheduler-commit.png)

### スケジューラ - 悲観的\_ロールバック {#scheduler-pessimistic-rollback}

- スケジューラステージ合計：`pessimistic_rollback`コマンドの実行時の各ステージのコマンド数/秒。短時間で多くのエラーがあってはなりません。
- スケジューラコマンド時間：`pessimistic_rollback`コマンドの実行時に消費される時間。`1s`未満であるべきです。
- スケジューララッチ待機時間：`pessimistic_rollback`コマンドの実行時にラッチによって引き起こされる待機時間。`1s`未満であるべきです。
- スケジューラ読み取りキー：`pessimistic_rollback`コマンドによって読み取られたキーの数
- スケジューラ書き込みキー：`pessimistic_rollback`コマンドによって書き込まれたキーの数
- スケジューラスキャンの詳細：`pessimistic_rollback`コマンドの実行時の各CFのキースキャンの詳細。
- スケジューラスキャンの詳細\[ロック]：`pessimistic_rollback`コマンドの実行時のロックCFのキースキャンの詳細
- スケジューラスキャンの詳細\[書き込み]：`pessimistic_rollback`コマンドの実行時の書き込みCFのキースキャンの詳細
- スケジューラスキャンの詳細\[デフォルト]：`pessimistic_rollback`コマンドの実行時のデフォルトCFのキースキャンの詳細

### スケジューラ - 事前書き込み {#scheduler-prewrite}

- スケジューラステージ合計：事前書き込みコマンドの実行時の各ステージのコマンド数/秒。短時間で多くのエラーがあってはなりません。
- スケジューラコマンド時間：事前書き込みコマンドの実行時に消費される時間。`1s`未満であるべきです。
- スケジューララッチ待機時間：事前書き込みコマンドの実行時にラッチによって引き起こされる待機時間。`1s`未満であるべきです。
- スケジューラ読み取りキー：事前書き込みコマンドによって読み取られたキーの数
- スケジューラ書き込みキー：事前書き込みコマンドによって書き込まれたキーの数
- スケジューラスキャンの詳細：事前書き込みコマンドの実行時の各CFのキースキャンの詳細。
- スケジューラスキャンの詳細\[ロック]：事前書き込みコマンドの実行時のロックCFのキースキャンの詳細
- スケジューラスキャンの詳細\[書き込み]：事前書き込みコマンドの実行時の書き込みCFのキースキャンの詳細
- スケジューラスキャンの詳細\[デフォルト]：事前書き込みコマンドの実行時のデフォルトCFのキースキャンの詳細

### スケジューラ - ロールバック {#scheduler-rollback}

- スケジューラステージ合計：ロールバックコマンドの実行時の各ステージのコマンド数/秒。短時間で多くのエラーがあってはなりません。
- スケジューラコマンド時間：ロールバックコマンドの実行時に消費される時間。`1s`未満であるべきです。
- スケジューララッチ待機時間：ロールバックコマンドの実行時にラッチによって引き起こされる待機時間。`1s`未満であるべきです。
- スケジューラ読み取りキー：ロールバックコマンドによって読み取られたキーの数
- スケジューラ書き込みキー：ロールバックコマンドによって書き込まれたキーの数
- スケジューラスキャンの詳細：ロールバックコマンドの実行時の各CFのキースキャンの詳細。
- スケジューラスキャンの詳細\[ロック]：ロールバックコマンドの実行時のロックCFのキースキャンの詳細
- スケジューラスキャンの詳細\[書き込み]：ロールバックコマンドの実行時の書き込みCFのキースキャンの詳細
- スケジューラスキャンの詳細\[デフォルト]：ロールバックコマンドの実行時のデフォルトCFのキースキャンの詳細

### GC {#gc}

- GCタスク：gc\_workerによって処理されたGCタスクの数
- GCタスクの実行時間：GCタスクの実行にかかる時間
- TiDB GC秒：GCの実行時間
- TiDB GCワーカーアクション：TiDB GCワーカーアクションの数
- ロック解決の進捗：GCの第一フェーズ（ロック解決）の進捗
- TiKV Auto GCの進捗：GCの第二フェーズの進捗
- GC速度：GCによって削除されたキーの数/秒
- TiKV Auto GCセーフポイント：TiKV GCセーフ

### スナップショット {#snapshot}

- スナップショットメッセージの送信率：Raftスナップショットメッセージが送信される頻度
- 99% スナップショット処理時間：スナップショットの処理にかかる時間（P99）
- スナップショット状態のカウント：状態ごとのスナップショットの数
- 99.99% スナップショットサイズ：スナップショットのサイズ（P99.99）
- 99.99% スナップショットKVカウント：スナップショット内のKVの数（P99.99）

### タスク {#task}

- Workerが処理したタスク：ワーカーが1秒あたりに処理したタスクの数
- Workerの保留中のタスク：ワーカーの保留中および実行中のタスクの現在の数。通常の場合は`1000`未満であるべきです。
- FuturePoolが処理したタスク：FuturePoolが1秒あたりに処理したタスクの数
- FuturePoolの保留中のタスク：FuturePoolの保留中および実行中のタスクの現在の数

### Coprocessorの概要 {#coprocessor-overview}

- リクエスト処理時間：Coprocessorリクエストを受信してからリクエストの処理が完了するまでの合計時間
- 合計リクエスト数：タイプごとのリクエストの数（1秒あたり）
- 処理時間：実際にCoprocessorリクエストの処理にかかる時間のヒストグラム（1分ごと）
- 合計リクエストエラー：Coprocessorのリクエストエラーの数（1秒あたり）。短時間で多くのエラーが発生すべきではありません。
- 合計KVカーソル操作：タイプごとのKVカーソル操作の合計数（1秒あたり）。例：`select`、`index`、`analyze_table`、`analyze_index`、`checksum_table`、`checksum_index`。
- KVカーソル操作：タイプごとのKVカーソル操作のヒストグラム（1秒あたり）
- 合計RocksDBパフォーマンス統計：RocksDBパフォーマンスの統計
- 合計レスポンスサイズ：Coprocessorのレスポンスの合計サイズ

### Coprocessorの詳細 {#coprocessor-detail}

- 処理時間：実際にCoprocessorリクエストの処理にかかる時間のヒストグラム（1分ごと）
- 95% ストアごとの処理時間：TiKVインスタンスごとのCoprocessorリクエストの処理にかかる時間（1秒あたり）（P95）
- 待機時間：Coprocessorリクエストが処理されるのを待っている時間。通常の場合は`10s`未満であるべきです（P99.99）。
- 95% ストアごとの待機時間：TiKVインスタンスごとのCoprocessorリクエストが処理されるのを待っている時間（1秒あたり）（P95）
- 合計DAGリクエスト数：1秒あたりの合計DAGリクエスト数
- 合計DAGエグゼキューター数：1秒あたりの合計DAGエグゼキューター数
- 合計Opsの詳細（テーブルスキャン）：Coprocessorでの選択スキャンの実行時に1秒あたりのRocksDB内部操作の数
- 合計Opsの詳細（インデックススキャン）：Coprocessorでのインデックススキャンの実行時に1秒あたりのRocksDB内部操作の数
- CFごとの合計Opsの詳細（テーブルスキャン）：Coprocessorでの選択スキャンの実行時に各CFごとの1秒あたりのRocksDB内部操作の数
- CFごとの合計Opsの詳細（インデックススキャン）：Coprocessorでのインデックススキャンの実行時に各CFごとの1秒あたりのRocksDB内部操作の数

### スレッド {#threads}

- スレッドの状態：TiKVスレッドの状態
- スレッドI/O：各TiKVスレッドのI/Oトラフィック
- スレッドの自発的なコンテキストスイッチ：TiKVスレッドの自発的なコンテキストスイッチの数
- スレッドの非自発的なコンテキストスイッチ：TiKVスレッドの非自発的なコンテキストスイッチの数

### RocksDB - kv/raft {#rocksdb-kv-raft}

- Get操作：1秒あたりのGet操作の数
- Get処理時間：Get操作の実行にかかる時間
- Seek操作：1秒あたりのSeek操作の数
- Seek処理時間：Seek操作の実行にかかる時間
- Write操作：1秒あたりのWrite操作の数
- Write処理時間：Write操作の実行にかかる時間
- WAL同期操作：1秒あたりのWAL同期操作の数
- Write WAL処理時間：WALの書き込みにかかる時間
- WAL同期処理時間：WAL同期操作の実行にかかる時間
- 圧縮およびフラッシュ操作：1秒あたりの圧縮およびフラッシュ操作の数
- 圧縮処理時間：圧縮およびフラッシュ操作の実行にかかる時間
- SST読み取り時間：SSTファイルの読み取りにかかる時間
- 書き込みスタール時間：書き込みスタール時間。通常の場合は`0`であるべきです。
- Memtableサイズ：各カラムファミリーのメンテーブルサイズ
- Memtableヒット：メンテーブルのヒット率
- ブロックキャッシュサイズ：ブロックキャッシュのサイズ。共有ブロックキャッシュが無効になっている場合はカラムファミリーごとに分割されます。
- ブロックキャッシュヒット：ブロックキャッシュのヒット率
- ブロックキャッシュフロー：ブロックキャッシュ操作のタイプごとのフロー率
- ブロックキャッシュ操作：ブロックキャッシュ操作のタイプごとの数
- キーのフロー：キーの操作のタイプごとのフロー率
- 合計キー：各カラムファミリーのキーの数
- 読み取りフロー：読み取り操作のタイプごとのフロー率
- バイト/読み取り：1回の読み取り操作あたりのバイト数
- 書き込みフロー：書き込み操作のタイプごとのフロー率
- バイト/書き込み：1回の書き込み操作あたりのバイト数
- 圧縮フロー：圧縮操作のタイプごとのフロー率
- 保留中のバイト数：圧縮待ちのバイト数
- 読み取りの増幅：TiKVインスタンスごとの読み取りの増幅
- 圧縮比：各レベルの圧縮比
- スナップショットの数：TiKVインスタンスごとのスナップショットの数
- 最古のスナップショットの期間：最も古いリリースされていないスナップショットの生存期間
- 各レベルのファイル数：各レベルの異なるカラムファミリーのSSTファイルの数
- SSTファイルの取り込み時間（秒）：SSTファイルの取り込みにかかる時間
- 各CFのスタール条件の変更：各カラムファミリーのスタール条件の変更

### Raft Engine {#raft-engine}

- 操作
  - write：Raft Engineによる書き込み操作の数（1秒あたり）
  - read\_entry：Raft EngineによるRaftログ読み取り操作の数（1秒あたり）
  - read\_message：Raft EngineによるRaftメタデータ読み取り操作の数（1秒あたり）
- 書き込み処理時間：Raft Engineによる書き込み操作の処理時間。この処理時間は、これらのデータの書き込みに関与するディスクIOのレイテンシの合計に近いです。
- フロー
  - write：Raft Engineの書き込みトラフィック
  - rewrite append：書き直し追加ログのトラフィック
  - rewrite rewrite：書き直し書き直しログのトラフィック
- 書き込み処理時間の詳細（99%）
  - wal：Raft Engine WALの書き込みのレイテンシ
  - wait：書き込み前の待機時間
  - apply：メモリへのデータ適用にかかる時間
- 書き込まれたバイト数：Raft Engineによって書き込まれたバイト数
- WAL処理時間の詳細（P99%）：Raft Engine WALの書き込みの各段階にかかる時間
- ファイル数
  - append：Raft Engineによってデータを追加するために使用されるファイルの数
  - rewrite：Raft Engineによってデータを書き直すために使用されるファイルの数（書き直しはRocksDBの圧縮に似ています）
- エントリ数
  - rewrite：Raft Engineによって書き直されたエントリの数
  - append：Raft Engineによって追加されたエントリの数

### Titan - 全体 {#titan-all}

- Blobファイル数：TitanのBlobファイルの数
- Blobファイルサイズ：TitanのBlobファイルの合計サイズ
- Live Blobサイズ：有効なBlobレコードの合計サイズ
- Blobキャッシュヒット：Titanブロックキャッシュのヒット率
- イテレータが触れたBlobファイル数：単一のイテレータに関与するBlobファイルの数
- Blobファイル廃棄可能比率分布：Blobファイルの失敗したBlobレコードの比率分布
- Blobキーのサイズ：Titan Blobキーのサイズ
- Blob値のサイズ：Titan Blob値のサイズ
- BlobのGet操作：Titan BlobでのGet操作の数
- BlobのGet処理時間：Titan BlobでのGet操作の実行にかかる時間
- Blobのイテレーション操作：Titan Blobでのイテレーション操作の実行にかかる時間
- BlobのSeek処理時間：Titan BlobでのSeek操作の実行にかかる時間
- Blobの次の処理時間：Titan Blobでの次の操作の実行にかかる時間
- Blobの前の処理時間：Titan Blobでの前の操作の実行にかかる時間
- Blobキーのフロー：Titan Blobキーの操作のフロー率
- Blobバイトのフロー：Titan Blobキーのバイトのフロー率
- Blobファイル読み取り時間：Titan Blobファイルの読み取りにかかる時間
- Blobファイル書き込み時間：Titan Blobファイルの書き込みにかかる時間
- Blobファイル同期操作：Blobファイルの同期操作の数
- Blobファイル同期処理時間：Blobファイルの同期にかかる時間
- Blob GCアクション：Titan GCアクションの数
- Blob GC処理時間：Titan GCの処理時間
- Blob GCキーのフロー：Titan GCによって読み取られたキーと書き込まれたキーのフロー率
- Blob GCバイトのフロー：Titan GCによって読み取られたバイトと書き込まれたバイトのフロー率
- Blob GC入力ファイルサイズ：Titan GCの入力ファイルのサイズ
- Blob GC出力ファイルサイズ：Titan GCの出力ファイルのサイズ
- Blob GCファイル数：Titan GCに関与するBlobファイルの数

### 悲観的ロック {#pessimistic-locking}

- ロックマネージャースレッドCPU：ロックマネージャースレッドのCPU利用率
- ロックマネージャーが処理したタスク：ロックマネージャーが処理したタスクの数
- 待機時間の期間：トランザクションがロックが解放されるのを待機する時間
- 待機テーブル：待機テーブルの状態情報、ロックの数とロックを待っているトランザクションの数を含む
- デッドロック検出期間：デッドロックを検出するためにかかる時間
- エラーの検出：デッドロックを検出する際に遭遇したエラーの数、デッドロックの数を含む
- デッドロック検出リーダー：デッドロック検出リーダーが存在するノードの情報
- 悲観的ロックのメモリサイズの合計：インメモリの悲観的ロックが占有するメモリサイズ
- インメモリの悲観的ロックの結果：メモリに悲観的ロックを保存する結果。`full`は悲観的ロックがメモリに保存されなかった回数を意味する。メモリ制限を超えたため。

### Resolved-TS {#resolved-ts}

- Resolved-TSワーカーCPU：resolved-tsワーカースレッドのCPU利用率
- Advance-TSワーカーCPU：advance-tsワーカースレッドのCPU利用率
- スキャンロックワーカーCPU：スキャンロックワーカースレッドのCPU利用率
- Resolved-tsの最大ギャップ：このTiKVのすべてのアクティブなリージョンのresolved-tsと現在時刻の最大の時間差
- Safe-tsの最大ギャップ：このTiKVのすべてのアクティブなリージョンのsafe-tsと現在時刻の最大の時間差
- 最小のResolved TSリージョン：resolved-tsが最小のリージョンのID
- 最小のSafe TSリージョン：safe-tsが最小のリージョンのID
- リーダー要求のチェック期間：リーダー要求の処理にかかる時間の分布。リーダーへのリクエストの送信からリーダーでの応答の受信までの期間
- リージョンリーダーのresolved-tsの最大ギャップ：このTiKVのすべてのアクティブなリージョンのresolved-tsと現在時刻の最大の時間差、リージョンリーダーのみ
- 最小のリーダーResolved TSリージョン：resolved-tsが最小のリージョンのID、リージョンリーダーのみ
- ロックヒープサイズ：resolved-tsモジュールでロックを追跡するヒープのサイズ

### メモリ {#memory}

- アロケーター統計：メモリアロケーターの統計

### バックアップ {#backup}

- バックアップCPU：バックアップスレッドのCPU利用率
- レンジサイズ：バックアップレンジサイズのヒストグラム
- バックアップ期間：バックアップにかかる時間
- バックアップフロー：バックアップの合計バイト数
- ディスクスループット：インスタンスごとのディスクスループット
- バックアップレンジ期間：レンジのバックアップにかかる時間
- バックアップエラー：バックアップ中に遭遇したエラーの数

### 暗号化 {#encryption}

- 暗号化データキー：暗号化されたデータキーの合計数
- 暗号化されたファイル：暗号化されたファイルの数
- 暗号化の初期化：暗号化が有効かどうかを示す。`1`は有効を意味する。
- 暗号化メタファイルのサイズ：暗号化メタファイルのサイズ
- データの暗号化/復号化時間：データの暗号化/復号化にかかる時間のヒストグラム
- 暗号化メタファイルの読み書き期間：暗号化メタファイルの読み書きにかかる時間

### 共通パラメータの説明 {#explanation-of-common-parameters}

#### gRPCメッセージタイプ {#grpc-message-type}

1. トランザクションAPI：

   - kv\_get：`ts`で指定されたデータの最新バージョンを取得するコマンド
   - kv\_scan：データの範囲をスキャンするコマンド
   - kv\_prewrite：2PCの最初のフェーズでコミットされるデータを事前に書き込むコマンド
   - kv\_pessimistic\_lock：他のトランザクションがこのキーを変更するのを防ぐためにキーに悲観的ロックを追加するコマンド
   - kv\_pessimistic\_rollback：キーの悲観的ロックを削除するコマンド
   - kv\_txn\_heart\_beat：悲観的トランザクションや大規模なトランザクションの`lock_ttl`を更新してロールバックを防ぐコマンド
   - kv\_check\_txn\_status：トランザクションのステータスを確認するコマンド
   - kv\_commit：prewriteコマンドで書き込まれたデータをコミットするコマンド
   - kv\_cleanup：v4.0で廃止されたトランザクションをロールバックするコマンド
   - kv\_batch\_get：一度にバッチキーの値を取得するコマンド、`kv_get`と同様
   - kv\_batch\_rollback：複数のprewriteトランザクションを一括ロールバックするコマンド
   - kv\_scan\_lock：期限切れのトランザクションをクリーンアップするために`max_version`より前のバージョン番号のすべてのロックをスキャンするコマンド
   - kv\_resolve\_lock：トランザクションロックをコミットまたはロールバックするコマンド、トランザクションのステータスに応じて
   - kv\_gc：GCのコマンド
   - kv\_delete\_range：TiKVからデータの範囲を削除するコマンド

2. Raw API：

   - raw\_get：キーの値を取得するコマンド
   - raw\_batch\_get：バッチキーの値を取得するコマンド
   - raw\_scan：データの範囲をスキャンするコマンド
   - raw\_batch\_scan：複数の連続したデータ範囲をスキャンするコマンド
   - raw\_put：キー/値のペアを書き込むコマンド
   - raw\_batch\_put：複数のキー/値のペアを書き込むコマンド
   - raw\_delete：キー/値のペアを削除するコマンド
   - raw\_batch\_delete：複数のキー/値のペアを削除するコマンド
   - raw\_delete\_range：データの範囲を削除するコマンド

## TiKV-FastTuneダッシュボード {#tikv-fasttune-dashboard}

TiKVのパフォーマンスの問題が発生した場合、QPSの揺れ、レイテンシの揺れ、およびレイテンシの増加傾向などがある場合、**TiKV-FastTune**ダッシュボードを確認できます。このダッシュボードには、特にクラスターの書き込みワークロードが中程度または大規模な場合に診断に役立つパネルが含まれています。

書き込み関連のパフォーマンスの問題が発生した場合、まずTiDB関連のダッシュボードを確認できます。問題がストレージ側にある場合は、**TiKV-FastTune**ページを開き、それぞれのパネルをブラウズして確認できます。

**TiKV-FastTune**ダッシュボードでは、パフォーマンスの問題の可能性のある原因を示すタイトルが表示されます。提案された原因が正しいかどうかを確認するには、ページ上のグラフを確認できます。

グラフの左Y軸はストレージ側の書き込みRPC QPSを表し、右Y軸の一連のグラフは逆さまに描かれます。左側のグラフの形状が右側のグラフの形状と一致する場合、提案された原因が正しいです。

詳細なメトリクスと説明については、ダッシュボードの[ユーザーマニュアル](https://docs.google.com/presentation/d/1aeBF2VCKf7eo4-3TMyP7oPzFWIih6UBA53UI8YQASCQ/edit#slide=id.gab6b984c2a_1_352)を参照してください。
