---
title: Changefeed Overview
summary: Learn basic concepts, state definitions, and state transfer of changefeeds.
---

# チェンジフィードの概要 {#changefeed-overview}

チェンジフィードは、TiCDCのレプリケーションタスクであり、指定されたテーブルのデータ変更ログをTiDBクラスターから指定された下流にレプリケートします。TiCDCクラスターで複数のチェンジフィードを実行および管理することができます。

## チェンジフィードの状態移行 {#changefeed-state-transfer}

レプリケーションタスクの状態は、レプリケーションタスクの実行状態を表します。TiCDCの実行中に、レプリケーションタスクはエラーで失敗したり、手動で一時停止したり、再開したり、指定された`TargetTs`に到達したりすることがあります。これらの動作により、レプリケーションタスクの状態が変化することがあります。このセクションでは、TiCDCのレプリケーションタスクの状態と状態間の移行関係について説明します。

![TiCDCの状態移行](/media/ticdc/ticdc-changefeed-state-transfer.png)

前述の状態移行図の状態は次のように説明されます。

- `Normal`: レプリケーションタスクが正常に実行され、チェックポイント-tsが正常に進行します。
- `Stopped`: レプリケーションタスクが停止され、ユーザーがチェンジフィードを手動で一時停止したためです。この状態のチェンジフィードはGC操作をブロックします。
- `Warning`: レプリケーションタスクがエラーを返します。リカバリ可能なエラーのため、レプリケーションを続行できません。この状態のチェンジフィードは、`Normal`に状態が移行するまで再開を試み続けます。最大再試行時間は30分です。この時間を超えると、チェンジフィードは失敗状態に移行します。この状態のチェンジフィードはGC操作をブロックします。
- `Finished`: レプリケーションタスクが完了し、事前に設定された`TargetTs`に到達しました。この状態のチェンジフィードはGC操作をブロックしません。
- `Failed`: レプリケーションタスクが失敗しました。この状態のチェンジフィードは再開を試みません。失敗を処理するための十分な時間を確保するため、この状態のチェンジフィードはGC操作をブロックします。ブロックの期間は、`gc-ttl`パラメーターで指定され、デフォルト値は24時間です。v7.1.1以降のv7.1パッチバージョンでは、この期間内に根本的な問題が解決された場合、チェンジフィードを手動で再開することができます。それ以外の場合、チェンジフィードが`gc-ttl`期間を超えてこの状態にとどまると、レプリケーションタスクを再開し、回復することはできません。

> **Note:**
>
> チェンジフィードが`ErrGCTTLExceeded`、`ErrSnapshotLostByGC`、または`ErrStartTsBeforeGC`のエラーコードを遭遇した場合、GC操作はブロックされません。

前述の状態移行図の数字は次のように説明されます。

- ① `changefeed pause`コマンドを実行します。
- ② レプリケーションタスクを再開するために`changefeed resume`コマンドを実行します。
- ③ `changefeed`操作中にリカバリ可能なエラーが発生し、操作が自動的に再試行されます。
- ④ チェンジフィードの自動再試行が成功し、`checkpoint-ts`が引き続き進行します。
- ⑤ チェンジフィードの自動再試行が30分を超えて失敗します。チェンジフィードは失敗状態に移行します。この時点で、チェンジフィードは`gc-ttl`で指定された期間、上流のGCをブロックし続けます。
- ⑥ チェンジフィードが回復不可能なエラーに遭遇し、直接失敗状態に移行します。この時点で、チェンジフィードは`gc-ttl`で指定された期間、上流のGCをブロックし続けます。
- ⑦ チェンジフィードのレプリケーション進捗が`target-ts`で設定された値に達し、レプリケーションが完了します。
- ⑧ チェンジフィードが`gc-ttl`で指定された値よりも長い期間一時停止され、GCの進行エラーが発生し、再開できません。
- ⑨ v7.1.1以降のv7.1パッチバージョンでは、失敗の原因が解決され、チェンジフィードが`gc-ttl`で指定された値よりも短い期間一時停止された場合、`changefeed resume`コマンドを実行してレプリケーションタスクを再開することができます。

## チェンジフィードの操作 {#operate-changefeeds}

コマンドラインツール`cdc cli`を使用して、TiCDCクラスターとそのレプリケーションタスクを管理することができます。詳細については、[TiCDCチェンジフィードの管理](/ticdc/ticdc-manage-changefeed.md)を参照してください。

また、HTTPインターフェース（TiCDC OpenAPI機能）を使用して、TiCDCクラスターとそのレプリケーションタスクを管理することもできます。詳細については、[TiCDC OpenAPI](/ticdc/ticdc-open-api.md)を参照してください。

TiUPを使用してTiCDCをデプロイした場合、`tiup ctl:v<CLUSTER_VERSION> cdc`コマンドを実行して`cdc cli`を起動することができます。`v<CLUSTER_VERSION>`をTiCDCクラスターバージョン（例：`v7.1.3`）に置き換えてください。また、`cdc cli`を直接実行することもできます。
