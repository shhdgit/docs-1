---
title: Back Up and Restore TiDB Dedicated Data
summary: Learn how to back up and restore your TiDB Dedicated cluster.
aliases: ['/tidbcloud/restore-deleted-tidb-cluster']
---

# TiDB 専用データのバックアップと復元 {#back-up-and-restore-tidb-dedicated-data}

このドキュメントでは、 TiDB Cloud上で TiDB 専用クラスター データをバックアップおよび復元する方法について説明します。 TiDB D dedicated は自動バックアップと手動バックアップをサポートしています。バックアップ データを新しいクラスターに復元したり、削除されたクラスターをごみ箱から復元したりすることもできます。

> **ヒント**
>
> TiDB サーバーレス クラスター データをバックアップおよび復元する方法については、 [TiDB サーバーレス データのバックアップと復元](/tidb-cloud/backup-and-restore-serverless.md)を参照してください。

## 制限事項 {#limitations}

-   v6.2.0 以降のバージョンのクラスターの場合、TiDB D dedicated は、デフォルトでバックアップからのユーザー アカウントと SQL バインディングの復元をサポートします。
-   TiDB D dedicated は、 `mysql`スキーマに保存されているシステム変数の復元をサポートしていません。
-   最初にデータをインポートし、次に**手動**スナップショット バックアップを実行し、最後にポイントインタイム リストアを有効にすることをお勧めします。 TiDB Cloudコンソールを通じてインポートされたデータは変更ログを生成**しない**ため、自動的に検出してバックアップすることはできません。詳細については、 [Amazon S3 または GCS からTiDB Cloudに CSV ファイルをインポート](/tidb-cloud/import-csv-files.md)を参照してください。
-   ポイントインタイム リストアを複数回オン/オフにした場合は、最新のポイントインタイム リストアが有効になった後の回復可能な範囲内の時点のみを選択できます。以前の回復可能範囲にはアクセスできません。
-   **ポイントインタイム復元**と**デュアルリージョンバックアップ**のスイッチを同時に変更しないでください。

## バックアップ {#backup}

### 自動バックアップをオンにする {#turn-on-auto-backup}

TiDB Dended は[スナップショットバックアップ](https://docs.pingcap.com/tidb/stable/br-snapshot-guide)と[ログのバックアップ](https://docs.pingcap.com/tidb/stable/br-pitr-guide)の両方をサポートします。スナップショット バックアップを使用すると、データをバックアップ ポイントに復元できます。デフォルトでは、スナップショット バックアップは自動的に作成され、バックアップ保持ポリシーに従って保存されます。自動バックアップはいつでも無効にできます。

#### ポイントインタイム復元を有効にする {#turn-on-point-in-time-restore}

> **注記**
>
> ポイントインタイム リストア機能は、v6.4.0 以降の TiDB 専用クラスターでサポートされています。

この機能は、任意の時点のデータを新しいクラスターに復元することをサポートします。これを使用して次のことができます。

-   災害復旧における RPO を削減します。
-   エラー イベントの前の時点を復元することで、データ書き込みエラーのケースを解決します。
-   ビジネスの履歴データを監査します。

この機能をオンにすることを強くお勧めします。コストはスナップショットバックアップと同じです。詳細については、 [データバックアップコスト](https://www.pingcap.com/tidb-dedicated-pricing-details#backup-storage-cost)を参照してください。

この機能を有効にするには、次の手順を実行します。

1.  TiDB 専用クラスターの**バックアップ**ページに移動します。

2.  **[バックアップ設定]**をクリックします。

3.  **[自動バックアップ]**スイッチを**[オン]**に切り替えます。

4.  **[ポイントインタイム復元]**スイッチを**[オン]**に切り替えます。

    > **警告**
    >
    > ポイントインタイム リストアは、次のバックアップ タスクが完了した後にのみ有効になります。より早く有効にするには、有効にした後に[バックアップを手動で実行する](#perform-a-manual-backup)を実行します。

5.  **「確認」**をクリックして構成の変更をプレビューします。

6.  もう一度**「確認」**をクリックして変更を保存します。

#### バックアップスケジュールの構成 {#configure-backup-schedule}

TiDB D dedicated は、日次および週次のバックアップ スケジュールをサポートしています。デフォルトでは、バックアップ スケジュールは毎日に設定されています。スナップショット バックアップを開始する日または週の特定の時刻を選択できます。

バックアップ スケジュールを構成するには、次の手順を実行します。

1.  TiDB 専用クラスターの**バックアップ**ページに移動します。

2.  **[バックアップ設定]**をクリックします。

3.  **[自動バックアップ]**スイッチを**[オン]**に切り替えます。

4.  バックアップ スケジュールを次のように構成します。

    -   **[バックアップ スケジューラ]**で、 **[毎日]**または**[毎週]**チェックボックスを選択します。 **[毎週]**を選択した場合は、バックアップを行う曜日を指定する必要があります。

        > **警告**
        >
        > -   毎週のバックアップが有効になっている場合、ポイントインタイム リストア機能はデフォルトで有効になり、無効にすることはできません。
        > -   バックアップ スケジューラを毎週から毎日に変更しても、ポイントインタイム リストア機能は元の設定のままになります。必要に応じて手動で無効にすることができます。

    -   **[バックアップ時間]**で、日次または週次のクラスター バックアップの開始時刻をスケジュールします。

        優先バックアップ時刻を指定しない場合、 TiDB Cloudはデフォルトのバックアップ時刻を割り当てます。これは、クラスターが配置されているリージョンのタイムゾーンの午前 2 時です。

        > **注記**
        >
        > -   データ インポート ジョブの進行中、バックアップ ジョブは自動的に遅延されます。データのインポート中またはクラスターのスケーリング中に手動バックアップを実行し**ないでください**。

    -   **[バックアップの保持期間]**で、バックアップ データの最小保持期間を構成します。デフォルトの期間は 7 日間です。ビジネスへの影響を最小限に抑えるために、ワークロードが低い期間に自動バックアップをスケジュールすることをお勧めします。

        > **注記**
        >
        > -   クラスターを削除すると、自動バックアップ ファイルはバックアップ保持期間で設定された指定期間保持されます。必要に応じてバックアップ ファイルを削除する必要があります。
        > -   クラスターを削除した後、既存の手動バックアップ ファイルは、手動で削除するかアカウントが閉鎖されるまで保持されます。

### デュアル リージョン バックアップを有効にする (ベータ版) {#turn-on-dual-region-backup-beta}

> **注記：**
>
> -   デュアル リージョン バックアップ機能は現在ベータ版です。
> -   Google Cloud でホストされている TiDB 専用クラスターは、Google Cloud Storage とシームレスに連携します。 Google Cloud Storage と同様に、 **TiDB D dedicated は、Google デュアルリージョンstorageと同じマルチリージョン コード内でのみデュアルリージョン ペアリングをサポートします**。たとえば、アジアでは現在、デュアルリージョンstorageを使用するには東京と大阪をペアにする必要があります。詳細については、 [デュアルリージョン](https://cloud.google.com/storage/docs/locations#location-dr)を参照してください。

TiDB D dedicated は、クラスター リージョンから別の異なるリージョンにバックアップをレプリケートすることにより、デュアル リージョン バックアップをサポートします。この機能を有効にすると、すべてのバックアップが指定されたリージョンに自動的にレプリケートされます。これにより、リージョン間のデータ保護と災害復旧機能が提供されます。データの約 99% を 1 時間以内にセカンダリ リージョンにレプリケートできると推定されます。

デュアル リージョンのバックアップ コストには、バックアップstorageの使用量とリージョン間のデータ転送料金の両方が含まれます。詳細については、 [データバックアップコスト](https://www.pingcap.com/tidb-dedicated-pricing-details#backup-storage-cost)を参照してください。

デュアル リージョン バックアップを有効にするには、次の手順を実行します。

1.  TiDB 専用クラスターの**バックアップ**ページに移動します。

2.  **[バックアップ設定]**をクリックします。

3.  **[デュアルリージョンバックアップ]**スイッチを**[オン]**に切り替えます。

4.  **[デュアルリージョン]**ドロップダウン リストから、バックアップ ファイルを保存するリージョンを選択します。

5.  **「確認」**をクリックして構成の変更をプレビューします。

6.  もう一度**「確認」**をクリックして変更を保存します。

### 自動バックアップをオフにする {#turn-off-auto-backup}

> **注記**
>
> 自動バックアップをオフにすると、ポイントインタイム復元もデフォルトでオフになります。

自動バックアップをオフにするには、次の手順を実行します。

1.  TiDB 専用クラスターの**バックアップ**ページに移動します。

2.  **[バックアップ設定]**をクリックします。

3.  **[自動バックアップ]**スイッチを**[オフ]**に切り替えます。

4.  **「確認」**をクリックして構成の変更をプレビューします。

5.  もう一度**「確認」**をクリックして変更を保存します。

### デュアル リージョン バックアップをオフにする (ベータ版) {#turn-off-dual-region-backup-beta}

> **ヒント**
>
> デュアル リージョンのバックアップを無効にしても、セカンダリ リージョンのバックアップはすぐには削除されません。これらのバックアップは、バックアップ保持スケジュールに従って後でクリーンアップされます。それらをすぐに削除するには、手動で[バックアップを削除する](#delete-backups)を実行します。

デュアル リージョン バックアップをオフにするには、次の手順を実行します。

1.  TiDB 専用クラスターの**バックアップ**ページに移動します。

2.  **[バックアップ設定]**をクリックします。

3.  **[デュアルリージョンバックアップ]**スイッチを**[オフ]**に切り替えます。

4.  **「確認」**をクリックして構成の変更をプレビューします。

5.  もう一度**「確認」**をクリックして変更を保存します。

### 手動バックアップを実行する {#perform-a-manual-backup}

手動バックアップはユーザーが開始するバックアップで、必要に応じてデータを既知の状態にバックアップし、いつでもその状態に復元できます。

TiDB 専用クラスターに手動バックアップを適用するには、次の手順を実行します。

1.  クラスターの**「バックアップ」**タブに移動します。

2.  **[手動バックアップ]**をクリックします。設定ウィンドウが表示されます。

3.  **名前**を入力します。

4.  **「確認」**をクリックします。その後、クラスター データがバックアップされます。

### バックアップを削除する {#delete-backups}

#### バックアップファイルを削除する {#delete-backup-files}

既存のバックアップ ファイルを削除するには、次の手順を実行します。

1.  クラスターの**「バックアップ」**タブに移動します。

2.  削除するバックアップ ファイルの**[削除]**をクリックします。

#### 実行中のバックアップ ジョブを削除する {#delete-a-running-backup-job}

実行中のバックアップ ジョブを削除するには、 [**バックアップファイルを削除する**](#delete-backup-files)と同様です。

1.  クラスターの**「バックアップ」**タブに移動します。

2.  **保留**中または**実行中**状態のバックアップ ファイルの**[削除]**をクリックします。

## 復元する {#restore}

### データを新しいクラスターに復元する {#restore-data-to-a-new-cluster}

> **注記**
>
> TiDB クラスターをバックアップから復元する場合、復元プロセスでは元のタイムゾーン設定が上書きされずに保持されます。

TiDB 専用クラスター データをバックアップから新しいクラスターに復元するには、次の手順を実行します。

1.  クラスターの**「バックアップ」**タブに移動します。

2.  **「復元」**をクリックします。設定ウィンドウが表示されます。

3.  **[復元モード]**で、バックアップ ストアのリージョンを示す**[リージョンから復元]**を選択します。

    > **注記**
    >
    > -   **[リージョンからの復元]**のデフォルト値は、バックアップ クラスターと同じです。

4.  **[復元モード]**では、任意の時点のデータまたは選択したバックアップを新しいクラスターに復元することを選択します。

    <SimpleTab>
     <div label="Select Time Point">

    バックアップ保持期間内の任意の時点のデータを新しいクラスターに復元するには、**バックアップ設定**の**ポイントインタイム復元が**オンになっていることを確認してから、次の手順を実行します。

    -   **[時点の選択]**をクリックします。
    -   復元したい**日付**と**時刻**を選択します。

    </div>

    <div label="Select Backup Name">

    選択したバックアップを新しいクラスターに復元するには、次の手順を実行します。

    -   **[バックアップ名の選択]**をクリックします。
    -   復元先のバックアップを選択します。

    </div>
     </SimpleTab>

5.  **[リージョンに復元]**で、**バックアップ設定**で構成された**バックアップ ストレージリージョン**と同じリージョンを選択します。

6.  **[復元]**ウィンドウでは、必要に応じて次の変更を行うこともできます。

    -   クラスター名を設定します。
    -   クラスターのポート番号を更新します。
    -   クラスターのノード数、vCPU と RAM、storageを増やします。

7.  **「復元」**をクリックします。

    クラスターの復元プロセスが開始され、 **[Security設定]**ダイアログ ボックスが表示されます。

8.  **[Security設定]**ダイアログ ボックスで、root パスワードとクラスターへの接続を許可する IP アドレスを設定し、 **[適用]**をクリックします。

### 削除されたクラスターを復元する {#restore-a-deleted-cluster}

> **注記：**
>
> 削除されたクラスターを任意の時点に復元することはできません。復元するには自動または手動バックアップのみを選択できます。

削除されたクラスターをごみ箱から復元するには、次の手順を実行します。

1.  [TiDB Cloudコンソール](https://tidbcloud.com)にログインします。

2.  クリック<mdsvgicon name="icon-left-projects">複数のプロジェクトがある場合は、左下隅でターゲット プロジェクトに切り替え、 **[プロジェクト設定]**をクリックします。</mdsvgicon>

3.  プロジェクトの [**プロジェクト設定]**ページで、左側のナビゲーション ペインで**[ごみ箱]**をクリックし、復元するクラスターを見つけて、 **[操作]**列の**[バックアップ]**をクリックします。

4.  希望のバックアップ時刻を見つけて、 **[アクション]**列の**[復元]**をクリックします。

5.  **[復元]**ウィンドウで、必要に応じて次の変更を加えます。

    -   クラスターのポート番号を更新します。
    -   クラスターのノード数、vCPU、RAM、storageを増やします。

6.  **「確認」**をクリックします。

    クラスターの復元プロセスが開始され、 **[Security設定]**ダイアログ ボックスが表示されます。

7.  **[Security設定]**ダイアログ ボックスで、root パスワードとクラスターへの接続を許可する IP アドレスを設定し、 **[適用]**をクリックします。
