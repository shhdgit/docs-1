---
title: Back Up and Restore TiDB Dedicated Data
summary: Learn how to back up and restore your TiDB Dedicated cluster.
aliases: ['/tidbcloud/restore-deleted-tidb-cluster']
---

# バックアップとリストアTiDB Dedicatedデータ {#back-up-and-restore-tidb-dedicated-data}

このドキュメントでは、TiDB Cloud上のTiDB Dedicatedクラスターデータのバックアップとリストア方法について説明します。TiDB Dedicatedは自動バックアップと手動バックアップの両方をサポートしています。また、バックアップデータを新しいクラスターにリストアしたり、リサイクルビンから削除されたクラスターをリストアしたりすることもできます。

> **ヒント**
>
> TiDB Serverlessクラスターデータのバックアップとリストア方法については、[バックアップとリストアTiDB Serverlessデータ](/tidb-cloud/backup-and-restore-serverless.md)を参照してください。

## 制限事項 {#limitations}

- v6.2.0以降のクラスターについて、TiDB DedicatedはデフォルトでバックアップからユーザーアカウントとSQLバインディングをリストアすることをサポートしています。
- TiDB Dedicatedは`mysql`スキーマに保存されているシステム変数のリストアをサポートしていません。
- TiDB Cloudコンソールを介してインポートされたデータは変更ログを生成しないため、手動でスナップショットバックアップを実行し、最後にポイントインタイムリストアを有効にすることが推奨されています。詳細については、[Amazon S3またはGCSからCSVファイルをTiDB Cloudにインポート](/tidb-cloud/import-csv-files.md)を参照してください。
- ポイントインタイムリストアとデュアルリージョンバックアップのスイッチを同時にオンにしないでください。

## バックアップ {#backup}

### 自動バックアップをオンにする {#turn-on-auto-backup}

TiDB Dedicatedは[スナップショットバックアップ](https://docs.pingcap.com/tidb/stable/br-snapshot-guide)と[ログバックアップ](https://docs.pingcap.com/tidb/stable/br-pitr-guide)の両方をサポートしています。スナップショットバックアップにより、バックアップポイントにデータをリストアできます。デフォルトでは、スナップショットバックアップは自動的に実行され、バックアップ保持ポリシーに従って保存されます。いつでも自動バックアップを無効にすることができます。

#### ポイントインタイムリストアをオンにする {#turn-on-point-in-time-restore}

> **注意**
>
> ポイントインタイムリストア機能は、v6.4.0以降のTiDB Dedicatedクラスターでサポートされています。

この機能は、任意の時点のデータを新しいクラスターにリストアすることをサポートしています。これにより、次のことができます。

- ディザスタリカバリでのRPOの削減。
- データ書き込みエラーを解決するために、エラーイベントの前のポイントインタイムをリストアする。
- ビジネスの過去のデータを監査する。

この機能をオンにすることを強くお勧めします。コストはスナップショットバックアップと同じです。詳細については、[データバックアップコスト](https://www.pingcap.com/tidb-dedicated-pricing-details#backup-storage-cost)を参照してください。

この機能をオンにするには、次の手順を実行します。

1. TiDB Dedicatedクラスターの**バックアップ**ページに移動します。

2. **バックアップ設定**をクリックします。

3. **自動バックアップ**スイッチを**オン**に切り替えます。

4. **ポイントインタイムリストア**スイッチを**オン**に切り替えます。

   > **警告**
   >
   > ポイントインタイムリストアは、次のバックアップタスクが完了した後にのみ有効になります。それを早く有効にするには、[手動でバックアップを実行](#perform-a-manual-backup)することができます。

5. 構成変更をプレビューするために**確認**をクリックします。

6. 変更を保存するために**確認**をもう一度クリックします。

#### バックアップスケジュールを構成する {#configure-backup-schedule}

TiDB Dedicatedは、デイリーおよびウィークリーのバックアップスケジュールをサポートしています。デフォルトでは、バックアップスケジュールはデイリーに設定されています。特定の時間または曜日を選択してスナップショットバックアップを開始できます。

バックアップスケジュールを構成するには、次の手順を実行します。

1. TiDB Dedicatedクラスターの**バックアップ**ページに移動します。

2. **バックアップ設定**をクリックします。

3. **自動バックアップ**スイッチを**オン**に切り替えます。

4. 次のようにバックアップスケジュールを構成します。

   - **バックアップスケジューラ**で、**デイリー**または**ウィークリー**のチェックボックスを選択します。**ウィークリー**を選択する場合は、バックアップの曜日を指定する必要があります。

     > **警告**
     >
     > - ウィークリーバックアップが有効になっている場合、ポイントインタイムリストア機能がデフォルトで有効になり、無効にすることはできません。
     > - バックアップスケジューラをウィークリーからデイリーに変更すると、ポイントインタイムリストア機能は元の設定のままです。必要に応じて手動で無効にできます。

   - **バックアップ時間**で、デイリーまたはウィークリーのクラスターバックアップの開始時間をスケジュールします。

     希望のバックアップ時間を指定しない場合、TiDB Cloudはクラスターが配置されているリージョンのタイムゾーンで午前2時のデフォルトバックアップ時間を割り当てます。

     > **注意**
     >
     > - データインポートジョブが進行中の場合、バックアップジョブは自動的に遅延されます。データインポートやクラスタースケーリング中に手動バックアップを実行しないでください。

   - **バックアップ保持**で、最小のバックアップデータ保持期間を構成します。デフォルトの期間は7日です。ビジネスへの影響を最小限に抑えるために、低いワークロード期間中に自動バックアップをスケジュールすることをお勧めします。

     > **注意**
     >
     > - クラスターを削除した後、自動バックアップファイルはバックアップ保持で設定された期間だけ保持されます。それに応じてバックアップファイルを削除する必要があります。
     > - クラスターを削除した後、既存の手動バックアップファイルは手動で削除するか、アカウントが閉じられるまで保持されます。

### デュアルリージョンバックアップをオンにする {#turn-on-dual-region-backup}

> **注意:**
>
> Google CloudでホストされているTiDB Dedicatedクラスターは、Google Cloud Storageとシームレスに連携します。Google Cloud Storageと同様に、**TiDB DedicatedはGoogleデュアルリージョンストレージの同じマルチリージョンコード内でのみデュアルリージョンペアリングをサポート**しています。たとえば、アジアでは、現在、デュアルリージョンストレージのために東京と大阪をペアにする必要があります。詳細については、[デュアルリージョン](https://cloud.google.com/storage/docs/locations#location-dr)を参照してください。

TiDB Dedicatedは、クラスターリージョンから別の異なるリージョンにバックアップをレプリケートすることでデュアルリージョンバックアップをサポートしています。この機能を有効にすると、すべてのバックアップが指定されたリージョンに自動的にレプリケートされます。これにより、クロスリージョンのデータ保護とディザスタリカバリ機能が提供されます。約99%のデータが1時間以内にセカンダリリージョンにレプリケートされると見積もられています。

デュアルリージョンバックアップのコストには、バックアップストレージ使用量とクロスリージョンデータ転送料金が含まれます。詳細については、[データバックアップコスト](https://www.pingcap.com/tidb-dedicated-pricing-details#backup-storage-cost)を参照してください。

デュアルリージョンバックアップをオンにするには、次の手順を実行します。

1. TiDB Dedicatedクラスターの**バックアップ**ページに移動します。

2. **バックアップ設定**をクリックします。

3. **デュアルリージョンバックアップ**スイッチを**オン**に切り替えます。

4. **デュアルリージョン**のドロップダウンリストから、バックアップファイルを保存するリージョンを選択します。

5. 構成変更をプレビューするために**確認**をクリックします。

6. 変更を保存するために**確認**をもう一度クリックします。

### 自動バックアップをオフにする {#turn-off-auto-backup}

> **注意**
>
> 自動バックアップをオフにすると、デフォルトでポイントインタイムリストアもオフになります。

自動バックアップをオフにするには、次の手順を実行します。

1. TiDB Dedicatedクラスターの**バックアップ**ページに移動します。

2. **バックアップ設定**をクリックします。

3. **自動バックアップ**スイッチを**オフ**に切り替えます。

4. 構成変更をプレビューするために**確認**をクリックします。

5. 変更を保存するために**確認**をもう一度クリックします。

### デュアルリージョンバックアップをオフにする {#turn-off-dual-region-backup}

> **ヒント**
>
> デュアルリージョンバックアップを無効にしても、セカンダリリージョンのバックアップはすぐには削除されません。これらのバックアップはバックアップ保持スケジュールに従って後でクリーンアップされます。すぐに削除するには、手動で[バックアップを削除](#delete-backups)することができます。

デュアルリージョンバックアップをオフにするには、次の手順を実行します。

1. TiDB Dedicatedクラスターの**バックアップ**ページに移動します。

2. **バックアップ設定**をクリックします。

3. **デュアルリージョンバックアップ**スイッチを**オフ**に切り替えます。

4. 構成変更をプレビューするために**確認**をクリックします。

5. 変更を保存するために**確認**をもう一度クリックします。

### 手動バックアップを実行する {#perform-a-manual-backup}

手動バックアップはユーザーが開始するバックアップであり、必要に応じてデータを既知の状態にバックアップし、いつでもその状態にリストアできます。

TiDB Dedicatedクラスターに手動バックアップを適用するには、次の手順を実行します。

1. クラスターの**バックアップ**タブに移動します。

2. **手動バックアップ**をクリックします。設定ウィンドウが表示されます。

3. **名前**を入力します。

4. **確認**をクリックします。その後、クラスターデータがバックアップされます。

### バックアップを削除する {#delete-backups}

#### バックアップファイルを削除する {#delete-backup-files}

既存のバックアップファイルを削除するには、次の手順を実行します。

1. クラスターの**バックアップ**タブに移動します。

2. 削除したいバックアップファイルの**削除**をクリックします。

#### 実行中のバックアップジョブを削除する {#delete-a-running-backup-job}

実行中のバックアップジョブを削除するには、[**バックアップファイルを削除**](#delete-backup-files)と同様です。

1. クラスターの**バックアップ**タブに移動します。

2. **保留中**または**実行中**の状態のバックアップファイルの**削除**をクリックします。

## リストア {#restore}

### 新しいクラスターにデータを復元する {#restore-data-to-a-new-cluster}

> **Note**
>
> TiDBクラスターをバックアップから復元すると、復元プロセスは元のタイムゾーン設定を上書きせずに保持します。

TiDB Dedicatedクラスターのデータをバックアップから新しいクラスターに復元するには、次の手順を実行します。

1. クラスターの**バックアップ**タブに移動します。

2. **復元**をクリックします。設定ウィンドウが表示されます。

3. **復元モード**で、バックアップストアのリージョンを示す**リージョンからの復元**を選択します。

   > **Note**
   >
   > - **リージョンからの復元**のデフォルト値は、バックアップクラスターと同じです。

4. **復元モード**で、任意の時点のデータまたは新しいクラスターに選択したバックアップのデータを復元するように選択します。

    <SimpleTab>
    <div label="時点を選択">

   バックアップ保持期間内の任意の時点のデータを新しいクラスターに復元するには、**バックアップ設定**の**時点復元**がオンになっていることを確認し、次の手順を実行します。

   - **時点を選択**をクリックします。
   - 復元したい**日付**と**時刻**を選択します。

    </div>

    <div label="バックアップ名を選択">

   新しいクラスターに選択したバックアップを復元するには、次の手順を実行します。

   - **バックアップ名を選択**をクリックします。
   - 復元したいバックアップを選択します。

    </div>
    </SimpleTab>

5. **復元先リージョン**で、**バックアップ設定**で構成された**バックアップストレージリージョン**と同じリージョンを選択します。

6. **復元**ウィンドウでは、必要に応じて次の変更も行うことができます。

   - クラスター名を設定します。
   - クラスターのポート番号を更新します。
   - クラスターのノード数、vCPUおよびRAM、およびストレージを増やします。

7. **復元**をクリックします。

   クラスターの復元プロセスが開始され、**セキュリティ設定**ダイアログボックスが表示されます。

8. **セキュリティ設定**ダイアログボックスで、ルートパスワードとクラスターに接続するための許可されたIPアドレスを設定し、**適用**をクリックします。

### 削除されたクラスターを復元する {#restore-a-deleted-cluster}

> **Note:**
>
> 削除されたクラスターを任意の時点に復元することはできません。自動または手動のバックアップを選択して復元することしかできません。

ゴミ箱から削除されたクラスターを復元するには、次の手順を実行します。

1. [TiDB Cloudコンソール](https://tidbcloud.com)にログインします。

2. 左下隅の<MDSvgIcon name="icon-left-projects" />をクリックし、複数のプロジェクトを持っている場合は、対象のプロジェクトに切り替えてから**プロジェクト設定**をクリックします。

3. プロジェクトの**プロジェクト設定**ページで、左側のナビゲーションペインで**ゴミ箱**をクリックし、復元したいクラスターを見つけてから**アクション**列の**バックアップ**をクリックします。

4. 復元したいバックアップ時刻を見つけ、**アクション**列の**復元**をクリックします。

5. **復元**ウィンドウで、必要に応じて次の変更を行います。

   - クラスターのポート番号を更新します。
   - クラスターのノード数、vCPUおよびRAM、およびストレージを増やします。

6. **確認**をクリックします。

   クラスターの復元プロセスが開始され、**セキュリティ設定**ダイアログボックスが表示されます。

7. **セキュリティ設定**ダイアログボックスで、ルートパスワードとクラスターに接続するための許可されたIPアドレスを設定し、**適用**をクリックします。
